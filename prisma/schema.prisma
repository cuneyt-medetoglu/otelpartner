// OtelPartner - DATA_STRUCTURE.md ile uyumlu
// Faz 1: User, Hotel, Guide. Diğer modeller ileride eklenecek.

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  admin
  hotel
  guide
}

enum UserStatus {
  pending
  active
  suspended
  rejected
}

model User {
  id            String     @id @default(cuid())
  email         String     @unique
  password      String
  role          Role
  status        UserStatus @default(pending)
  emailVerified Boolean    @default(false) @map("email_verified")
  createdAt     DateTime   @default(now()) @map("created_at")
  updatedAt     DateTime   @updatedAt @map("updated_at")

  hotel  Hotel?
  guide  Guide?
}

model Hotel {
  id          String   @id @default(cuid())
  userId      String   @unique @map("user_id")
  name        String
  description String?
  address     String?
  city        String?
  region      String?
  country     String   @default("Türkiye")
  starRating  Int?     @map("star_rating")
  phone       String?
  website     String?
  amenities   Json?    // [wifi, pool, spa, ...]
  latitude    Decimal? @db.Decimal(10, 7)
  longitude   Decimal? @db.Decimal(10, 7)
  listed      Boolean  @default(true)  // Katalogda listelensin mi (admin)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  user         User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  rooms        Room[]
  reservations Reservation[]
}

model Room {
  id          String   @id @default(cuid())
  hotelId     String   @map("hotel_id")
  roomType    String   @map("room_type")   // Tek kişilik, Çift kişilik, Suite, vb.
  totalCount  Int      @map("total_count")
  basePrice   Decimal? @map("base_price")  @db.Decimal(10, 2)
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")

  hotel         Hotel              @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  availability  RoomAvailability[]
  reservations  Reservation[]
}

model RoomAvailability {
  id              String   @id @default(cuid())
  roomId          String   @map("room_id")
  date            DateTime @db.Date
  availableCount  Int      @map("available_count")
  createdAt       DateTime @default(now()) @map("created_at")
  updatedAt       DateTime @updatedAt @map("updated_at")

  room Room @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@unique([roomId, date])
  @@map("room_availability")
}

model Guide {
  id            String        @id @default(cuid())
  userId        String        @unique @map("user_id")
  firstName     String        @map("first_name")
  lastName      String        @map("last_name")
  phone         String?
  licenseNumber String?       @map("license_number")
  companyName   String?       @map("company_name")
  city          String?
  region        String?
  createdAt     DateTime      @default(now()) @map("created_at")
  updatedAt     DateTime      @updatedAt @map("updated_at")

  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)
  reservations  Reservation[] @relation("GuideReservations")
}

model Reservation {
  id             String           @id @default(cuid())
  reservationCode String         @unique @map("reservation_code")
  guideId        String           @map("guide_id")
  hotelId        String           @map("hotel_id")
  roomId         String           @map("room_id")
  checkInDate    DateTime         @map("check_in_date") @db.Date
  checkOutDate   DateTime         @map("check_out_date") @db.Date
  roomCount      Int              @map("room_count")
  guestCount     Int?             @map("guest_count")
  totalPrice     Decimal?         @map("total_price") @db.Decimal(10, 2)
  status         ReservationStatus @default(pending)
  rejectionReason String?         @map("rejection_reason")
  createdAt      DateTime         @default(now()) @map("created_at")
  updatedAt      DateTime         @updatedAt @map("updated_at")

  guide Guide @relation("GuideReservations", fields: [guideId], references: [id], onDelete: Cascade)
  hotel Hotel @relation(fields: [hotelId], references: [id], onDelete: Cascade)
  room  Room  @relation(fields: [roomId], references: [id], onDelete: Cascade)

  @@map("reservations")
}

enum ReservationStatus {
  pending
  approved
  rejected
  cancelled
}
